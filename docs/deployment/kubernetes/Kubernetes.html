<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Kubernetes · Twister2</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="We assume that Kubernetes cluster is already installed and kubectl is configured. "/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Kubernetes · Twister2"/><meta property="og:type" content="website"/><meta property="og:url" content="https://twister2.org/"/><meta property="og:description" content="We assume that Kubernetes cluster is already installed and kubectl is configured. "/><meta property="og:image" content="https://twister2.org/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://twister2.org/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://twister2.org/blog/atom.xml" title="Twister2 Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://twister2.org/blog/feed.xml" title="Twister2 Blog RSS Feed"/><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat|Oswald|Roboto&amp;display=swap"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/code-blocks-buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo_large.png" alt="Twister2"/><h2 class="headerTitleWithLogo">Twister2</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/introduction" target="_self">Getting Started</a></li><li class="siteNavGroupActive"><a href="/docs/compiling/compile_overview" target="_self">Docs</a></li><li class=""><a href="/docs/examples/tset/hello_world" target="_self">Tutorial</a></li><li class=""><a href="/docs/examples/examples" target="_self">Examples</a></li><li class=""><a href="/docs/developers/debugging" target="_self">Contribute</a></li><li class=""><a href="/docs/download" target="_self">Download</a></li><li class=""><a href="/configs" target="_self">Configurations</a></li><li class=""><a href="/javadocs/index.html" target="_self">Java Docs</a></li><li class=""><a href="https://github.com/DSC-SPIDAL/twister2" target="_blank">GitHub</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Deployment</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Compiling</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/compiling/compile_overview">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/compiling/linux">Linux</a></li><li class="navListItem"><a class="navItem" href="/docs/compiling/macos">MacOS</a></li><li class="navListItem"><a class="navItem" href="/docs/compiling/generate-maven">Maven Artifacts</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">App Development</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/concepts/api_overview">API Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/guides/developing_twister2">Developing Applications</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/streaming_jobs">Streaming Jobs</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/batch_jobs">Batch Jobs</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">APIs</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/concepts/worker_api">Worker API</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/tset_api">Data API</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/task_api">Compute API</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/op_api">Operator API</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/windowing/windowing_api">Windowing API</a></li><li class="navListItem"><a class="navItem" href="/docs/compatibility/storm">Storm API</a></li><li class="navListItem"><a class="navItem" href="/docs/compatibility/apachebeam">Apache Beam</a></li><li class="navListItem"><a class="navItem" href="/docs/compatibility/pythonapi">Python API</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Deployment</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/deployment/job-submit">Job Submit</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/standalone/standalone">Standalone</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/docker/docker">Docker</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/deployment/kubernetes/Kubernetes">Kubernetes</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/minikube/Minikube">Minikube</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/mesos/mesos">Mesos</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/nomad/nomad">Nomad</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/slurm/slurm">Slurm</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/dashboard">Dashboard</a></li><li class="navListItem"><a class="navItem" href="/docs/deployment/logging">Logging</a></li><li class="navListItem"><a class="navItem" href="/docs/configurations/configurations">Configurations</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Concepts</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/concepts/concepts">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/distributed_runtime">Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/par_ops">Operators</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/task-system/concept_task">Task System</a></li><li class="navListItem"><a class="navItem" href="/docs/concepts/data-access/data_access">Data Access</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Resources</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/publications">Publications</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Kubernetes</h1></header><article><div><span><p>We assume that Kubernetes cluster is already installed and kubectl is configured.
To install Twister2 on Minikube, please follow the steps at:
<a href="/docs/deployment/minikube/Minikube">Installing Twister2 on Minikube</a></p>
<p>To install and compile Twister2 project on your machine, please follow the steps in <a href="/docs/compiling/compile_overview">compiling document</a>.
You may also check <a href="/docs/developers/devenv">developer document</a> for setting up IDEs.</p>
<p>To run Twister2 jobs on Kubernetes clusters, You must perform the following step:</p>
<ul>
<li><a href="#authorization-of-pods"><strong>Authorization of Pods</strong></a>.</li>
</ul>
<p>Here are the steps to run jobs in Kubernetes clusters:</p>
<ul>
<li><a href="#running-jobs-in-kubernetes"><strong>Running Jobs in Kubernetes</strong></a></li>
</ul>
<p>Here are the list of optional installations/settings:</p>
<ul>
<li><a href="#job-package-uploader-settings"><strong>Job Package Uploader Settings</strong></a>: This is recommended to upload the job package through a web server.</li>
<li><a href="#deploying-twister2-dashboard"><strong>Deploying Twister2 Dashboard</strong></a>: This is a recommended step to monitor Twister2 jobs on Kubernetes clusters.</li>
<li><a href="#persistent-storage-settings"><strong>Persistent Storage Settings</strong></a>: You can set up persistent storage only if you want to use.</li>
<li><a href="#fault-tolerant-jobs"><strong>Fault Tolerant Jobs</strong></a>: A ZooKeeper server is required, if you want to run fault-tolerant Twister2 jobs.</li>
<li><a href="#generating-secret-object-for-openmpi-jobs"><strong>Generating Secret Object for OpenMPI Jobs</strong></a>: This is required only if you are going to run OpenMPI jobs.</li>
<li><a href="#providing-rack-and-datacenter-information-to-twister2"><strong>Providing Rack and Datacenter Information</strong></a>: This is required only if you want Twister2 to perform rack and data center aware scheduling.</li>
</ul>
<p>Twister2 runs jobs in Docker containers in Kubernetes clusters.
Developers need to rebuild Twister2 Docker image if they want to modify twister2 source codes:</p>
<ul>
<li><a href="#building-twister2-docker-image-for-kubernetes"><strong>Building Twister2 Docker Image for Kubernetes</strong></a></li>
</ul>
<p><strong>Requirements</strong>:</p>
<ul>
<li>Twister2 requires Kubernetes version v1.10 or higher.</li>
<li>When ZooKeeper is used, at least ZooKeeper version 3.5 or above is required.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="authorization-of-pods"></a><a href="#authorization-of-pods" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Authorization of Pods</h2>
<p>Twister2 Worker pods need to watch Job Master pod and get its IP address.
In addition, Job Master needs to be able to scale worker pods during the computation
and delete job resources after the job has completed.
Therefore, before submitting a job, a Role and a RoleBinding object need to be created.
We prepared the following YAML file: twister2-auth.yaml.</p>
<p>If you are using &quot;default&quot; namespace, then execute the following command:</p>
<pre><code class="hljs css language-bash">    $ kubectl create -f https://raw.githubusercontent.com/DSC-SPIDAL/twister2/master/twister2/config/src/yaml/conf/kubernetes/deployment/twister2-auth.yaml
</code></pre>
<p>If you are not using &quot;default&quot; namespace, download the above yaml file,
change the namespace field value to the namespace value that your users will use to submit Twister2 jobs.
Then, execute the following command:</p>
<pre><code class="hljs css language-bash">    $ kubectl create -f /path/to/file/twister2-auth.yaml
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="running-jobs-in-kubernetes"></a><a href="#running-jobs-in-kubernetes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running Jobs in Kubernetes</h2>
<p>You can submit and kill jobs in Kubernetes as it is explained in the <a href="/docs/deployment/job-submit">job submission document</a>.
You must specify the cluster type as &quot;kubernetes&quot;.</p>
<p>If there is a problem with job submission, job submission client will exit with a corresponding message
printed to the screen. Otherwise, job submission client either finishes execution with success or
waits to upload the job package to workers.</p>
<h3><a class="anchor" aria-hidden="true" id="job-logs"></a><a href="#job-logs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Job Logs</h3>
<p>You can see the job logs either from Kubernetes Dashboard website, using kubectl command or
through persistent storage logs if enabled.
The workers in HelloWorld job prints a log message and sleeps 1 minutes before exiting.
So the user can check Kubernetes Dashboard website for worker log messages.
There must be a StatefulSet with the job name. List the pods in that StatefulSet.
Check the output for each pod by clicking on the right hand side button.
You will see the output for each worker in that window.</p>
<p>To see the logs by using kubectl, you first need to learn the pod names in the job.
You can execute &quot;kubectl get pods&quot; command to list the pods in the cluster.
The pod names for the job are in the form of &lt;job-name&gt;&lt;ss-index&gt;&lt;pod-index&gt;.
You can see the logs of each pod by executing the command:</p>
<pre><code class="hljs css language-bash">    $ kubectl logs &lt;podname&gt;
</code></pre>
<p>You can also check the log files from persistent storage if the persistent storage is enabled.
You need to learn the persistent logging directory of your storage provisioner.
You can learn it from Kubernetes Dashboard by checking the provisioner entity or consulting your administrator.
Check that directory for the job logs.</p>
<h3><a class="anchor" aria-hidden="true" id="logs-for-mpi-enabled-jobs"></a><a href="#logs-for-mpi-enabled-jobs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Logs for MPI Enabled Jobs</h3>
<p>The outputs of MPI enabled jobs are a little different in Kubernetes Dashboard and pod logs.
In those jobs, first worker starts all other workers by using mpirun command.
Therefore, the outputs of all other pods are transferred to the first pod.<br>
So, all outputs from all workers in an MPI enabled job is shown in first worker pod.
The pods of other workers will only have initialization messages.</p>
<p>However, persistent log files are different. In those files, each worker has its own log messages in its log file.
Therefore, checking log files would be more preferable in MPI enabled jobs compared to checking the dashboard.</p>
<h3><a class="anchor" aria-hidden="true" id="configuration-settings"></a><a href="#configuration-settings" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration Settings</h3>
<p>Configuration files for kubernetes clusters are under the directory:</p>
<pre><code class="hljs css language-text">conf/kubernetes/
</code></pre>
<p>You can specify job related configurations either through resource.yaml file or in your job java file
by using Twister2Job class methods.
If you specify job parameters in resource.yaml file, then you can load them by using following method in your code:</p>
<pre><code class="hljs css language-text">Twister2Job.loadTwister2Job()
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="job-names"></a><a href="#job-names" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Job Names</h3>
<p>We are using job names as StatefulSet and Service names. In addition we are using job names as labels.
Therefore job names must follow Kubernetes naming rules: <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/names/">Kubernetes resource naming rules</a>.</p>
<p>Job names should consist of lower case alphanumeric characters and dash(-) only. Their length can be 50 chars at most.
If job names do not conform to these rules, we automatically change them to accommodate those rules.
We use the changed names as job names.</p>
<h2><a class="anchor" aria-hidden="true" id="job-package-uploader-settings"></a><a href="#job-package-uploader-settings" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Job Package Uploader Settings</h2>
<p>When users submit a Twister2 job in Kubernetes cluster,
submitting client needs to transfer the job package to workers and the job master.
The submitting client first packs all job related files into a tar package file.
This archive file needs to be transferred to each worker pod that will be started.</p>
<p>We provide <a href="/docs/architecture/resource-schedulers/kubernetes/twister2-on-kubernetes">two methods</a>:</p>
<ul>
<li>Job package file transfer from submitting client to job pods directly</li>
<li>Job package file transfer through uploader web server pods</li>
</ul>
<p>We first check whether there is any uploader web server running in the cluster.
If there is, we upload the job package to the uploader web server pods.
Job pods download the job package from uploader web server pods.
Otherwise, submitting client uploads the job package to all pods in the job directly.
Both methods transfer the job package from client to pods by using kubectl copy method.</p>
<p>If you are running many Twister2 jobs with many workers,
it would be more efficient and faster to run uploader web server pods.
We designed a StatefulSet that runs an nginx web server.
You can deploy it with following command:</p>
<pre><code class="hljs css language-bash">$ kubectl create -f https://raw.githubusercontent.com/DSC-SPIDAL/twister2/master/twister2/config/src/yaml/conf/kubernetes/deployment/twister2-uploader-wo-ps.yaml
</code></pre>
<p>You can modify the number of replicas in uploader web server yaml file above or
the compute resources used.</p>
<p>If you choose to use your own web server pods,
then you need to specify following configuration parameters in resource.yaml file:</p>
<pre><code class="hljs css language-text">    twister2.kubernetes.uploader.web.server
    twister2.kubernetes.uploader.web.server.directory
    twister2.kubernetes.uploader.web.server.label
</code></pre>
<p>Please check conf/kubernetes/resource.yaml file for more explanation about these parameters.</p>
<h2><a class="anchor" aria-hidden="true" id="deploying-twister2-dashboard"></a><a href="#deploying-twister2-dashboard" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deploying Twister2 Dashboard</h2>
<p>Twister2 Dashboard enables users to monitor their jobs through a web browser.
Although installing this dashboard is not mandatory for running Twister2 jobs, it is highly recommended.
A single instance of the Dashboard runs in each cluster for all users.</p>
<p>If you are using default namespace, then you can deploy Twister2 Dashboard without persistent storage as:</p>
<pre><code class="hljs css language-bash">    $ kubectl create -f https://raw.githubusercontent.com/DSC-SPIDAL/twister2/master/twister2/config/src/yaml/conf/kubernetes/deployment/twister2-dashboard-wo-ps.yaml
</code></pre>
<p>If you are using another namespace, or would like to change a parameter of Dashboard,
then you can download this file, change the desired parameter values and
execute the create command on the modified file.</p>
<h3><a class="anchor" aria-hidden="true" id="accessing-dashboard"></a><a href="#accessing-dashboard" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Accessing Dashboard</h3>
<p>You can access the Dashboard from any machine that has kubectl installed and
has the credentials to connect to the kubernetes cluster.</p>
<p>First run the following command in your workstation to create a secure channel:</p>
<pre><code class="hljs css language-bash">    $ kubectl proxy
</code></pre>
<p>Then, access Dashboard at the following URL:</p>
<pre><code class="hljs css language-text">    http://localhost:8001/api/v1/namespaces/default/services/http:twister2-dashboard:/proxy/#/
</code></pre>
<p>If you are using a namespace other than the default, replace &quot;default&quot; in the URL with your namespace value.</p>
<h3><a class="anchor" aria-hidden="true" id="running-dashboard-as-a-standalone-web-server"></a><a href="#running-dashboard-as-a-standalone-web-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running Dashboard as a standalone web server</h3>
<p>You can also run Dashboard as a standalone webserver in your cluster.
Job master pod should be able to access the machine that is running Dashboard to be able to feed job status data.</p>
<p>Run Dashboard server with the following command:</p>
<pre><code class="hljs css language-bash">    $ bin/twister2 dash
</code></pre>
<p>Dashboard runs at the port 8080.</p>
<p>You need to give the address of Dashboard at the configuration file: conf/kubernetes/core.yaml
You should set the value of following parameter:</p>
<pre><code class="hljs css language-text">    twister2.dashboard.host: "http://<host-address>:8080"
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="persistent-storage-settings"></a><a href="#persistent-storage-settings" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Persistent Storage Settings</h2>
<p>To enable persistent storage in Twister2, a StorageClass must exist in the cluster backed by a dynamic storage provisioner.
The name of the persistent StorageClass needs to be specified in the conf/kubernetes/resource.yaml configuration file.
Configuration parameter is:</p>
<pre><code class="hljs css language-text">    twister2.resource.kubernetes.persistent.storage.class
</code></pre>
<p>We tested with NFS-Client provisioner from: <a href="https://github.com/kubernetes-incubator/external-storage/tree/master/nfs-client">https://github.com/kubernetes-incubator/external-storage/tree/master/nfs-client</a>
We also tested with provisioners in AWS and Minikube.</p>
<h2><a class="anchor" aria-hidden="true" id="fault-tolerant-jobs"></a><a href="#fault-tolerant-jobs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fault Tolerant Jobs</h2>
<p>We use ZooKeeper servers to save job meta state in fault tolerant jobs.
In the case of failures, job master and workers get the job meta data from zookeeper servers and rejoin.</p>
<p>ZooKeeper servers are not used in non-fault tolerant Twister2 jobs.</p>
<p>Following configuration parameter needs to be set as true to specify the job as fault tolerant in core.yaml:</p>
<pre><code class="hljs css language-text">twister2.fault.tolerant
</code></pre>
<p>The addresses of ZooKeeper servers are specified with the configuration parameter in resource.yaml.
If there are multiple zookeeper servers, they can be specified in the form of &quot;ip1:port,ip2:port,ip3:port&quot;</p>
<pre><code class="hljs css language-text">twister2.resource.zookeeper.server.addresses
</code></pre>
<p>If you do not already have a ZooKeeper server running, you can run an experimental one by deploying it
as a pod. We have a yaml file for that. You can deploy it as:</p>
<pre><code class="hljs css language-bash">$ kubectl create -f https://raw.githubusercontent.com/DSC-SPIDAL/twister2/master/twister2/config/src/yaml/conf/kubernetes/deployment/zookeeper-wo-persistence.yaml
</code></pre>
<p>Then you can get its ip address by using following command and specify that in above resource.yaml file.
It runs at the port 2181.</p>
<pre><code class="hljs css language-bash">$ kubectl get pods -o=wide | grep twister2-zookeeper
</code></pre>
<p><strong>Requirement</strong>: Twister2 requires at least ZooKeeper version of 3.5.</p>
<h2><a class="anchor" aria-hidden="true" id="generating-secret-object-for-openmpi-jobs"></a><a href="#generating-secret-object-for-openmpi-jobs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Generating Secret Object for OpenMPI Jobs</h2>
<p>When using OpenMPI communications in Twister2, pods need to have password-free SSH access among them.
This is accomplished by first generating an SSH key pair and deploying them as a Kubernetes Secret on the cluster.</p>
<p>First, generate an SSH key pair and save them in files by using:</p>
<pre><code class="hljs css language-bash">    $ ssh-keygen
</code></pre>
<p>Second, create a Kubernetes Secret object for the namespace of Twister2 users with the already generated key pairs.
Execute the following command by specifying generated key files. Last parameter is the namespace.
If you are using a namespace other than default, please change that.</p>
<pre><code class="hljs css language-bash">    $ kubectl create secret generic twister2-openmpi-ssh-key --from-file=id_rsa=/path/to/.ssh/id_rsa --from-file=id_rsa.pub=/path/to/.ssh/id_rsa.pub --from-file=authorized_keys=/path/to/.ssh/id_rsa.pub --namespace=default
</code></pre>
<p>The fifth parameter (twister2-openmpi-ssh-key) is the name of the Secret object to be generated.
That has to match the following configuration parameter in the network.yaml file:</p>
<pre><code class="hljs css language-text">    kubernetes.secret.name
</code></pre>
<p>You can retrieve the created Secret object in YAML form by executing the following command:</p>
<pre><code class="hljs css language-bash">    $ kubectl get secret &lt;secret-name&gt; -o=yaml
</code></pre>
<p>Another possibility for deploying the Secret object is to use the <a href="https://raw.githubusercontent.com/DSC-SPIDAL/twister2/master/docs/architecture/resource-schedulers/kubernetes/yaml-templates/secret.yaml">YAML file template</a>. You can edit that secret.yaml file. You can put the public and private keys to the corresponding fields. You can set the name and the namespace values. Then, you can create the Secret object by using kubectl method as:</p>
<pre><code class="hljs css language-bash">    $ kubectl create secret -f /path/to/file/secret.yaml
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="providing-rack-and-datacenter-information-to-twister2"></a><a href="#providing-rack-and-datacenter-information-to-twister2" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Providing Rack and Datacenter Information to Twister2</h2>
<p>Twister2 can use rack names and data center names of the nodes when scheduling tasks.
There are two ways administrators and users can provide this information.</p>
<p><strong>Through Configuration Files</strong>:<br>
Users can provide the IP addresses of nodes in racks in their clusters.
In addition, they can provide the list of data centers with rack data in them.</p>
<p>Here is an example configuration:</p>
<pre><code class="hljs css language-text">    kubernetes.datacenters.list:
    - dc1: ['blue-rack', 'green-rack']
    - dc2: ['rack01', 'rack02']

    kubernetes.racks.list:
    - blue-rack: ['node01.ip', 'node02.ip', 'node03.ip']
    - green-rack: ['node11.ip', 'node12.ip', 'node13.ip']
    - rack01: ['node51.ip', 'node52.ip', 'node53.ip']
    - rack02: ['node61.ip', 'node62.ip', 'node63.ip']
</code></pre>
<p>Put these lists to resource.yaml file. Then, assign the following configuration parameter in resource.yaml as true:</p>
<pre><code class="hljs css language-text">    kubernetes.node.locations.from.config
</code></pre>
<p><strong>Labelling Nodes With Rack and Data Center Information</strong>:<br>
Administrators can label their nodes in the cluster for their rack and datacenter information.
Each node in the cluster must be labelled once. When users submit a Twister2 job,
submitting client first queries Kubernetes master for the labels of nodes.
It provides this list to all workers in the job.</p>
<p><strong>Note</strong>: For this solution to work, job submitting users must have admin privileges.</p>
<p><strong>Example Labelling Commands</strong>: Administrators can use kubectl command to label the nodes in the cluster.
The format of the label creation command is as follows:</p>
<pre><code class="hljs css language-text">    $ kubectl label node <node-name> <label-key>=<label-value>
</code></pre>
<p>Then, used rack and data center labels must be provided in the configuration files.
These configuration parameters are:</p>
<pre><code class="hljs css language-text">    rack.labey.key
    datacenter.labey.key
</code></pre>
<p>To get the rack and datacenter information from Kubernetes master using labels,
the value of the following configuration parameter has to be specified as false in client.yaml file:</p>
<pre><code class="hljs css language-text">    kubernetes.node.locations.from.config
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="building-twister2-docker-image-for-kubernetes"></a><a href="#building-twister2-docker-image-for-kubernetes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Building Twister2 Docker Image for Kubernetes</h2>
<p>First, build Twister2 project.</p>
<p>This will generate the twister2 package file:</p>
<p>bazel-bin/scripts/package/twister2-0.4.0.tar.gz</p>
<p>While on twister2 main directory, unpack this tar file:</p>
<pre><code class="hljs css language-bash">$ tar xf bazel-bin/scripts/package/twister2-0.4.0.tar.gz
</code></pre>
<p>This will extract the files under twister2-0.4.0 directory.</p>
<p>Build Docker image by running the following command from twister2 main directory.
Update username with your Docker Hub user name.</p>
<pre><code class="hljs css language-bash">$ docker build -t &lt;username&gt;/twister2-k8s:0.4.0 -f docker/kubernetes/image/Dockerfile .
</code></pre>
<p>Push generated Docker image to Docker Hub. If you have not already logged in to Docker Hub account,
please login first with command: &quot;docker login docker.io&quot;</p>
<pre><code class="hljs css language-bash">$ docker push &lt;username&gt;/twister2-k8s:0.4.0
</code></pre>
<p>Update Docker Image name in the following resource.yaml file.
Put new Docker Image name as the value of the key: &quot;twister2.resource.kubernetes.docker.image&quot;</p>
<pre><code class="hljs css language-bash">$ nano twister2/config/src/yaml/conf/kubernetes/resource.yaml
</code></pre>
<p>You may also want to update the value of the following key to &quot;Always&quot; in the same &quot;resource.yaml&quot;
file:</p>
<pre><code class="hljs">kubernetes<span class="hljs-selector-class">.image</span><span class="hljs-selector-class">.pull</span><span class="hljs-selector-class">.policy</span>: <span class="hljs-string">"Always"</span>
</code></pre>
<p>With this, docker will pull the twister2 image from Docker Hub at each run.<br>
This may slow down startup times for the jobs.
However, if you repeatedly build the docker image, this may be convenient.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/deployment/docker/docker"><span class="arrow-prev">← </span><span>Docker</span></a><a class="docs-next button" href="/docs/deployment/minikube/Minikube"><span>Minikube</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#authorization-of-pods">Authorization of Pods</a></li><li><a href="#running-jobs-in-kubernetes">Running Jobs in Kubernetes</a><ul class="toc-headings"><li><a href="#job-logs">Job Logs</a></li><li><a href="#logs-for-mpi-enabled-jobs">Logs for MPI Enabled Jobs</a></li><li><a href="#configuration-settings">Configuration Settings</a></li><li><a href="#job-names">Job Names</a></li></ul></li><li><a href="#job-package-uploader-settings">Job Package Uploader Settings</a></li><li><a href="#deploying-twister2-dashboard">Deploying Twister2 Dashboard</a><ul class="toc-headings"><li><a href="#accessing-dashboard">Accessing Dashboard</a></li><li><a href="#running-dashboard-as-a-standalone-web-server">Running Dashboard as a standalone web server</a></li></ul></li><li><a href="#persistent-storage-settings">Persistent Storage Settings</a></li><li><a href="#fault-tolerant-jobs">Fault Tolerant Jobs</a></li><li><a href="#generating-secret-object-for-openmpi-jobs">Generating Secret Object for OpenMPI Jobs</a></li><li><a href="#providing-rack-and-datacenter-information-to-twister2">Providing Rack and Datacenter Information to Twister2</a></li><li><a href="#building-twister2-docker-image-for-kubernetes">Building Twister2 Docker Image for Kubernetes</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo_large.png" alt="Twister2" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/en/quickstart.html">Getting Started (Quickstart)</a><a href="/docs/en/concepts/api_overview">Guides (Programming Guides)</a></div><div><h5>Community</h5><a href="https://stackoverflow.com/questions/tagged/" target="_blank" rel="noreferrer noopener">Stack Overflow</a><a href="https://dsc-twister.slack.com/">Project Chat</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/DSC-SPIDAL/twister2">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2020 Indiana University</section></footer></div></body></html>